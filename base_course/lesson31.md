## Урок 31: Лямбда-функции. Функции `map()`, `filter()`, `sorted()`. Функция `reduce()`.

### 31.1 Что такое лямбда-функции?

**Лямбда-функции** — это **анонимные функции, которые создаются с помощью ключевого слова `lambda`**. Они позволяют **описывать простые однострочные функции без необходимости их явного объявления через `def`**.

#### Лямбда-функции полезны, когда:

- **Требуется быстро создать простую функцию**.
- **Функция нужна только для короткого использования**.
- **Использование именованной функции кажется избыточным**.

#### Преимущества лямбда-функций:

- **Компактность**: код становится короче.
- **Гибкость**: удобно использовать как аргумент в функциях **высшего порядка** (map, filter, sorted).

#### Ограничения:

- **Лямбда-функция может содержать только одно выражение**.
- **Отсутствие аннотаций типов аргументов**.
- **Сложные выражения могут снизить читаемость**.

### 31.2 Общая структура

- Синтаксис лямбда-функции:

  ```
  lambda аргументы: выражение
  ```

  - **Аргументы**: **список входных параметров, разделенных запятыми**.
  - **Выражение**: **одно выражение, результат которого возвращается автоматически**.

**Пример лямбда-функции для сложения двух чисел**:

```python
add = lambda x, y: x + y
print(add(2, 3))  # Вывод: 5
```

**Эта функция эквивалентна следующей функции**, определенной через `def`:

```python
def add(x, y):
    return x + y
```

### 31.3 Примеры простых лямбда-функций

#### Пример 1: Возведение числа в квадрат

```python
square = lambda x: x**2
print(square(5))  # Вывод: 25
```

#### Пример 2: Проверка числа на четность

```python
is_even = lambda x: x % 2 == 0
print(is_even(4))  # Вывод: True
print(is_even(5))  # Вывод: False
```

#### Пример 3: Вычисление площади прямоугольника

```python
rectangle_area = lambda length, width: length * width
print(rectangle_area(4, 5))  # Вывод: 20
```

### 31.4 Функции высшего порядка. Функции `map()`, `filter()`, `sorted()`

**Функция** считается `функцией высшего порядка`, если она:

- **Принимает другую функцию в качестве аргумента**.
- **Возвращает функцию в качестве результата**.
- **Примеры функций** высшего порядка в Python — это `map()`, `filter()`, `sorted()`.

**Эти функции часто используются вместе с `лямбда-функциями`** для выполнения сложных операций над данными.

### 31.5 Краткое описание функций

**Функции `map()`, `filter()`, и `sorted()` часто используются для работы с последовательностями**. Рассмотрим их базовые примеры.

- **Функция** `map()` **применяет заданную функцию ко всем элементам последовательности и возвращает новый итератор**.

  **Синтаксис**:

  ```python
  map(функция, последовательность)
  ```

  **Пример: Преобразование чисел в строки**

  ```python
  def to_string(x):
      return str(x)

  numbers = [1, 2, 3, 4]
  result = list(map(to_string, numbers))
  print(result)  # Вывод: ['1', '2', '3', '4']
  ```

  **Здесь каждый элемент списка numbers преобразуется в строку с помощью функции `to_string`**.

- **Функция** `filter()` **выбирает только те элементы последовательности, для которых заданная функция возвращает `True`**.

  **Синтаксис**:

  ```python
  filter(функция, последовательность)
  ```

  **Пример: Отбор чисел больше 5**

  ```python
  def greater_than_five(x):
      return x > 5

  numbers = [3, 6, 8, 2, 7]
  result = list(filter(greater_than_five, numbers))
  print(result)  # Вывод: [6, 8, 7]
  ```

  **Здесь из списка numbers отбираются только числа, которые больше 5**.

- **Функция** `sorted()` **возвращает новый отсортированный список из элементов последовательности**.

  **Синтаксис**:

  ```python
  sorted(последовательность, key=функция, reverse=логическое_значение)
  ```

  - `key`: задает функцию для определения порядка сортировки (опционально).
  - `reverse`: если `True`, **сортировка выполняется в обратном порядке**.

  **Пример: Сортировка списка строк по алфавиту**

  ```python
  words = ['banana', 'apple', 'cherry']
  result = sorted(words)
  print(result)  # Вывод: ['apple', 'banana', 'cherry']
  ```

  **Пример: Сортировка чисел в обратном порядке**

  ```python
  numbers = [5, 2, 9, 1]
  result = sorted(numbers, reverse=True)
  print(result)  # Вывод: [9, 5, 2, 1]
  ```

### 31.6 Использование `map()` с лямбда-функциями

**Функция `map()` проходит по каждому элементу последовательности и применяет к нему указанную функцию**.

- **Пример: Умножение каждого элемента списка на 2**

  ```python
  numbers = [1, 2, 3, 4, 5]
  doubled = list(map(lambda x: x * 2, numbers))
  print(doubled)  # Вывод: [2, 4, 6, 8, 10]
  ```

- **Пример: Преобразование строк в заглавные буквы**
  ```python
  words = ["hello", "world"]
  uppercase = list(map(lambda word: word.upper(), words))
  print(uppercase)  # Вывод: ['HELLO', 'WORLD']
  ```

### 31.7 Использование `filter()` с лямбда-функциями

**Функция `filter()` возвращает только те элементы, для которых функция-условие возвращает `True`**.

- **Пример: Фильтрация четных чисел**
  ```python
  numbers = [1, 2, 3, 4, 5]
  evens = list(filter(lambda x: x % 2 == 0, numbers))
  print(evens)  # Вывод: [2, 4]
  ```
- **Пример: Фильтрация строк длиной больше 3 символов**
  ```python
  words = ["cat", "elephant", "dog", "mouse"]
  long_words = list(filter(lambda word: len(word) > 3, words))
  print(long_words)  # Вывод: ['elephant', 'mouse']
  ```

### 31.8 Использование `sorted()` с лямбда-функциями

**Функция `sorted()` позволяет сортировать последовательности на основе функции, переданной в параметре `key`**.

- **Пример: Сортировка списка кортежей по второму элементу**
  ```python
  pairs = [(1, 'a'), (3, 'c'), (2, 'b')]
  sorted_pairs = sorted(pairs, key=lambda x: x[1])
  print(sorted_pairs)  # Вывод: [(1, 'a'), (2, 'b'), (3, 'c')]
  ```
- **Пример: Сортировка списка словарей по значению ключа**
  ```python
  people = [{"name": "Alice", "age": 25}, {"name": "Bob", "age": 20}]
  sorted_people = sorted(people, key=lambda person: person['age'])
  print(sorted_people)
  # Вывод: [{'name': 'Bob', 'age': 20}, {'name': 'Alice', 'age': 25}]
  ```

### 31.9 Комбинирование функций `map()`, `filter()`, и `sorted()`

**Эти функции можно объединять для создания цепочек преобразований данных**.

- **Пример: Отобрать четные числа, возвести их в квадрат и отсортировать**
  ```python
  numbers = [1, 2, 3, 4, 5, 6]
  result = sorted(
      map(lambda x: x**2, filter(lambda x: x % 2 == 0, numbers))
  )
  print(result)  # Вывод: [4, 16, 36]
  ```
- **Пример: Преобразование строк и их сортировка по длине**
  ```python
  words = ["apple", "banana", "kiwi", "cherry"]
  result = sorted(
      map(lambda word: word.upper(), filter(lambda word: len(word) > 4, words)),
      key=lambda word: len(word)
  )
  print(result)  # Вывод: ['APPLE', 'BANANA', 'CHERRY']
  ```

### 31.10 Функция reduce() из модуля functools.

**Функция `reduce()` из модуля `functools` — это инструмент для выполнения кумулятивных операций на последовательностях (например, списках или кортежах). Она поэтапно сводит последовательность элементов к одному значению, применяя указанную функцию.**

#### Принцип работы:

- **Берутся первые два элемента из последовательности и передаются в функцию**.
- **Результат операции используется как первый аргумент для следующего элемента из последовательности**.
- **Процесс продолжается до обработки всех элементов**.
- **Если указан `initializer`, он используется как начальное значение, и последовательность обрабатывается начиная с него**.

#### Примеры:

- **Пример нахождения суммы всех чисел с помощью функции `reduce()`**:

  ```python
  from functools import reduce

  numbers = [10, 20, 30, 40]

  # Используем reduce для суммирования
  total_sum = reduce(lambda x, y: x + y, numbers)

  print(f"Сумма чисел: {total_sum}")
  ```

- **Пример нахождения произведения чисел с помощью функции `reduce()`**:

  ```python
  from functools import reduce

  numbers = [2, 3, 4, 5]

  # Используем reduce для нахождения произведения
  product = reduce(lambda x, y: x * y, numbers)

  print(f"Произведение чисел: {product}")
  ```

- Пример нахождения суммы чисел с начальным значением с помощью функции `reduce()`\*\*:

  ```python
  from functools import reduce

  numbers = [10, 20, 30, 40]

  # Используем начальное значение
  total_sum = reduce(lambda x, y: x + y, numbers, 100)

  print(f"Сумма чисел с начальным значением "100": {total_sum}")
  ```

### 31.10 Примеры близкие к реальным задачам.

1. **Обработка списка товаров с ценами**

   **Предположим, у нас есть список товаров с их названиями и ценами**.

   Нужно:

   - **Преобразовать названия товаров в заглавные буквы**.
   - **Отобрать только товары дороже 50 единиц**.
   - **Отсортировать оставшиеся товары по цене по убыванию**.

     ```python
     products = [
         {"name": "apple", "price": 30},
         {"name": "banana", "price": 20},
         {"name": "cherry", "price": 60},
         {"name": "date", "price": 80},
     ]

     # 1. Преобразуем названия товаров в заглавные буквы
     products = list(map(lambda p: {**p, "name": p["name"].upper()}, products))

     # 2. Отбираем только товары дороже 50 единиц
     expensive_products = list(filter(lambda p: p["price"] > 50, products))

     # 3. Сортируем товары по цене по убыванию
     sorted_products = sorted(expensive_products, key=lambda p: p["price"], reverse=True)

     print(sorted_products)
     ```

2. **Анализ посещений сайта**

   **Имеется список посещений сайта в виде (страница, количество посещений)**.

   Нужно:

   - **Увеличить количество посещений на `10%`**.
   - **Отобрать страницы с посещениями больше `500`**.
   - **Отсортировать страницы по убыванию количества посещений**.

     ```python
     visits = [
         ("homepage", 450),
         ("products", 600),
         ("blog", 300),
         ("contact", 800),
     ]

     # 1. Увеличиваем количество посещений на 10%
     updated_visits = list(map(lambda v: (v[0], int(v[1] * 1.1)), visits))

     # 2. Отбираем страницы с посещениями больше 500
     popular_pages = list(filter(lambda v: v[1] > 500, updated_visits))

     # 3. Сортируем по убыванию посещений
     sorted_pages = sorted(popular_pages, key=lambda v: v[1], reverse=True)

     print(sorted_pages)
     ```

3. **Управление списком сотрудников**

   **Есть список сотрудников с их именами и зарплатами**.

   Задача:

   - **Преобразовать имена сотрудников, чтобы они начинались с заглавной буквы**.
   - **Отобрать только тех сотрудников, чья зарплата превышает среднюю по компании**.
   - **Отсортировать таких сотрудников по имени в алфавитном порядке**.

     ```python
     employees = [
         {"name": "john", "salary": 50000},
         {"name": "jane", "salary": 60000},
         {"name": "doe", "salary": 45000},
         {"name": "smith", "salary": 70000},
     ]

     # 1. Преобразуем имена сотрудников
     employees = list(map(lambda e: {**e, "name": e["name"].capitalize()}, employees))

     # 2. Рассчитываем среднюю зарплату
     average_salary = sum(e["salary"] for e in employees) / len(employees)

     # Отбираем сотрудников с зарплатой выше средней
     above_average = list(filter(lambda e: e["salary"] > average_salary, employees))

     # 3. Сортируем таких сотрудников по имени
     sorted_employees = sorted(above_average, key=lambda e: e["name"])

     print(sorted_employees)
     ```

4. **Подготовка данных для графиков**

   **Представим, что у нас есть данные о продажах за год в виде (месяц, доход)**.

   Нужно:

   - **Преобразовать названия месяцев в их порядковые номера (январь = 1, февраль = 2 и т.д.)**.
   - **Отобрать месяцы, где доход был выше `100000`**.
   - **Отсортировать их по возрастанию дохода**.

     ```python
     sales = [
         ("January", 95000),
         ("February", 120000),
         ("March", 130000),
         ("April", 85000),
     ]

     # Словарь для преобразования названий месяцев в номера
     month_to_number = {
         "January": 1, "February": 2, "March": 3, "April": 4,
         "May": 5, "June": 6, "July": 7, "August": 8,
         "September": 9, "October": 10, "November": 11, "December": 12
     }

     # 1. Преобразуем названия месяцев в номера
     numbered_sales = list(map(lambda s: (month_to_number[s[0]], s[1]), sales))

     # 2. Отбираем месяцы с доходом выше 100000
     high_income_months = list(filter(lambda s: s[1] > 100000, numbered_sales))

     # 3. Сортируем по возрастанию дохода
     sorted_high_income = sorted(high_income_months, key=lambda s: s[1])

     print(sorted_high_income)
     ```

5. **Расчет общего дохода с учетом начального баланса**

   **У компании есть начальный баланс, который вводится вручную с терминала. Также имеется список транзакций, где положительные числа представляют доходы, а отрицательные числа представляют расходы**.

   **Нужно**:

   - **Рассчитать итоговый баланс компании, применив все транзакции к начальному балансу**.
   - **Вывести итоговый баланс с пояснением**.

   ```python
   from functools import reduce

   # Ввод начального баланса вручную
   initial_balance = float(input("Введите начальный баланс компании: "))

   # Список транзакций (доходы и расходы)
   transactions = [500, -200, 300, -50, 1000]

   # Рассчитываем итоговый баланс
   final_balance = reduce(lambda balance, transaction: balance + transaction, transactions, initial_balance)

   # Условный вывод результата
   if final_balance > initial_balance:
       print(f"Итоговый баланс увеличился. Баланс: {final_balance:.2f}")
   elif final_balance < initial_balance:
       print(f"Итоговый баланс уменьшился. Баланс: {final_balance:.2f}")
   else:
       print(f"Итоговый баланс остался без изменений. Баланс: {final_balance:.2f}")
   ```

### Вопросы:

1. Что такое `lambda-функция` в Python?
2. Чем `lambda-функции` отличаются от обычных функций, определяемых с помощью `def`?
3. В каких случаях удобно использовать `lambda-функции`?
4. Что такое функции высшего порядка? Назовите примеры таких функций.
5. Для чего используется функция `map()`? Какие аргументы она принимает?
6. Для чего используется функция `filter()`? Какие аргументы она принимает?
7. Что возвращает функция `filter()`? Как преобразовать результат функции в список?
8. Какова роль функции `sorted()`? Какие параметры можно указать в её вызове?
9. Чем полезен параметр `key` в функциях `sorted()` и `map()`?
10. Могут ли `lambda-функции` принимать несколько аргументов? Если да, то приведите пример общего синтаксиса.
11. Если в `filter()` передать условие, которое никогда не выполняется, что будет возвращено?
12. Для чего используется функция `reduce()`?
13. Что произойдет, если начальное значение не указать в функции `reduce()`?

### Задачи:

1. **Преобразование строк в числа**. У вас есть список строк, представляющих числа. Преобразуйте их в список чисел с помощью `map()`.

   - **Входные данные**:

     ```python
     numbers = ["1", "2", "3", "4", "5"]
     ```

   - **Ожидаемый результат**:

     ```python
     [1, 2, 3, 4, 5]
     ```

2. **Увеличение чисел**. Дан список чисел. С помощью `map()` увеличьте каждое число на `10`.

   - Входные данные:

     ```python
     nums = [5, 10, 15, 20]
     ```

   - Ожидаемый результат:

     ```python
     [15, 20, 25, 30]
     ```

3. **Фильтрация строк по длине**. Дан список строк. Оставьте только те строки, длина которых больше 4 символов, используя `filter()`.

   - **Входные данные**:

     ```python
     words = ["apple", "cat", "banana", "dog", "kiwi"]
     ```

   - **Ожидаемый результат**:

     ```python
     ["apple", "banana"]
     ```

4. **Сортировка строк по алфавиту**. Дан список строк. Отсортируйте его в обратном алфавитном порядке с помощью `sorted()`.

   - **Входные данные**:

     ```python
     cities = ["Paris", "London", "Berlin", "Tokyo"]
     ```

   - **Ожидаемый результат**:

     ```python
     ["Tokyo", "Paris", "London", "Berlin"]
     ```

5. **Преобразование имен**. Дан список имен. Сделайте так, чтобы все имена начинались с заглавной буквы, используя `map()`.

   - **Входные данные**:

     ```python
     names = ["john", "sara", "michael", "anna"]
     ```

   - **Ожидаемый результат**:

     ```python
     ["John", "Sara", "Michael", "Anna"]
     ```

6. **Отбор четных чисел**. Дан список чисел. Оставьте только четные числа, используя `filter()`.

   - **Входные данные**:

     ```python
     nums = [1, 2, 3, 4, 5, 6, 7, 8, 9]
     ```

   - **Ожидаемый результат**:

     ```python
     [2, 4, 6, 8]
     ```

7. **Удвоение четных чисел**. Дан список чисел. Увеличьте только четные числа в два раза, используя `map()`.

   - **Входные данные**:

     ```python
     nums = [1, 2, 3, 4, 5, 6]
     ```

   - **Ожидаемый результат**:

     ```python
     [1, 4, 3, 8, 5, 12]
     ```

8. У вас есть список доходов компании за неделю: `[100, 200, 150, 300]`. Начальный баланс компании равен `1000`. Используйте функцию `reduce()` для вычисления итогового баланса компании. Выведите итоговый баланс

9. **Фильтрация пользователей по возрасту**. Дан словарь, где ключи — имена, а значения — возраст. Оставьте только тех пользователей, возраст которых больше `18`.

   - **Входные данные**:

     ```python
     users = {"Alice": 25, "Bob": 17, "Charlie": 19, "David": 15}
     ```

   - **Ожидаемый результат**:

     ```python
     {"Alice": 25, "Charlie": 19}
     ```

10. **Сортировка товаров по цене**. Дан список словарей, где каждый словарь представляет товар с ценой. Отсортируйте список по возрастанию цен.

    - **Входные данные**:

      ```python
      products = [{"name": "apple", "price": 100}, {"name": "banana", "price": 80}, {"name": "cherry", "price": 150}]
      ```

    - **Ожидаемый результат**:

      ```python
      [{"name": "banana", "price": 80}, {"name": "apple", "price": 100}, {"name": "cherry", "price": 150}]
      ```

11. **Удаление пустых строк**. Дан список строк. Удалите все пустые строки с помощью `filter()`.

    - **Входные данные**:

      ```python
      lines = ["hello", "", "world", "", "python"]
      ```

    - **Ожидаемый результат**:

      ```python
      ["hello", "world", "python"]
      ```

12. **Сортировка сотрудников по имени**. Дан список сотрудников, представленных словарями. Отсортируйте их по имени, не учитывая регистр букв.

    - **Входные данные**:

      ```python
      employees = [{"name": "John", "age": 28}, {"name": "alice", "age": 24}, {"name": "Bob", "age": 30}]
      ```

    - **Ожидаемый результат**:

      ```python
      [{"name": "alice", "age": 24}, {"name": "Bob", "age": 30}, {"name": "John", "age": 28}]
      ```

13. Вы ведете учет расходов на питание за неделю. Затраты распределены по дням: [50, 60, 40, 55, 70, 80, 65]. Начальный бюджет составляет 500. Используя функцию reduce(), рассчитайте, сколько денег останется после всех расходов.

    - Если бюджет становится отрицательным, выведите сообщение: "Бюджет превышен на {сумма}".
    - В противном случае выведите сообщение: "Осталось {сумма} в бюджете".

14. **Фильтрация и преобразование списка пользователей**. Дан список словарей, где каждый словарь представляет пользователя с его именем и возрастом. Оставьте только тех, кому больше `20 лет`, и преобразуйте имена в заглавные буквы.

    - **Входные данные**:

      ```python
      users = [{"name": "john", "age": 19}, {"name": "sara", "age": 22}, {"name": "mike", "age": 20}]
      ```

    - **Ожидаемый результат**:

      ```python
      [{"name": "SARA", "age": 22}]
      ```

15. **Сортировка заказов по дате**. Дан список заказов, где каждая дата представлена строкой. Отсортируйте их по убыванию даты.

    - **Входные данные**:

      ```python
      orders = [{"id": 1, "date": "2023-11-28"}, {"id": 2, "date": "2023-10-15"}, {"id": 3, "date": "2023-12-01"}]
      ```

    - **Ожидаемый результат**:

      ```python
      [{"id": 3, "date": "2023-12-01"}, {"id": 1, "date": "2023-11-28"}, {"id": 2, "date": "2023-10-15"}]
      ```

16. **Анализ текстовых данных**. Дана строка текста. Найдите все слова длиннее 4 символов, преобразуйте их в заглавные буквы и отсортируйте по алфавиту.

    - **Входные данные**:

      ```python
      text = "Python is a powerful programming language for data analysis"
      ```

    - **Ожидаемый результат**:

      ```python
      ["ANALYSIS", "LANGUAGE", "POWERFUL", "PROGRAMMING"]
      ```

17. **Анализ статистики заказов**. Дан список заказов, где каждый заказ представлен словарем с полем `price`. Найдите все заказы дороже `1000`, округлите их цены до сотен и отсортируйте по убыванию цены.

    - **Входные данные**:

      ```python
      orders = [{"id": 1, "price": 950}, {"id": 2, "price": 1200}, {"id": 3, "price": 850}, {"id": 4, "price": 1500}]
      ```

    - **Ожидаемый результат**:

      ```python
      [{"id": 4, "price": 1500}, {"id": 2, "price": 1200}]
      ```

18. Вы разрабатываете систему учета баланса счета пользователя с учетом сложных операций:

    У пользователя есть начальный баланс, который вводится вручную.
    Список операций представлен в виде списка словарей. Каждая операция содержит поля amount (сумма) и type (тип: "income" или "expense"). Например:

    ```python
    transactions = [
        {"amount": 500, "type": "income"},
        {"amount": 200, "type": "expense"},
        {"amount": 300, "type": "income"},
        {"amount": 100, "type": "expense"},
    ]
    ```

    - Введите начальный баланс с терминала.
    - Используйте функцию reduce() для последовательного расчета итогового баланса, где:
      - Доход (income) добавляется к текущему балансу.
      - Расход (expense) вычитается из текущего баланса.
    - Выведите итоговый баланс. Если он меньше нуля, выведите сообщение: "Баланс отрицательный: {значение}".
